# Guía para la Configuración de Servidores Rocky Linux 10 en los Tres Ambientes: DEV, TEST y PROD
(para revisión)

Dr. Jesús Zavala Ruiz[^1]

11 de Febrero de 2026

---

## Introducción

Esta guía proporciona un enfoque progresivo y escalonado para configurar servidores Rocky Linux 10 en los tres entornos fundamentales de una empresa o de una fábrica de software: Desarrollo (DEV), Pruebas (TEST) y Producción (PROD). Cada etapa se construye sobre la anterior, incorporando controles de seguridad, gobernanza y automatización adicionales para alinearse con los principios de soberanía tecnológica y las mejores prácticas empresariales.

## Principios Fundamentales de Gobernanza

Antes de comenzar, se deben establecer los siguientes principios que guiarán toda la configuración:
1.  **Aislamiento Total:** Cada entorno (DEV, TEST, PROD) debe operar en redes y dominios lógicamente separados.
2.  **Flujo Unidireccional:** Los cambios fluyen estrictamente de DEV → TEST → PROD. Nunca en sentido inverso.
3.  **Automatización Obligatoria:** Toda la configuración debe ser reproducible mediante scripts o herramientas de Infraestructura como Código (IaC).
4.  **Soberanía Tecnológica:** Se prioriza el uso de software de código abierto y estándares abiertos para mantener el control total sobre la infraestructura.

## Etapa 1: Entorno de Desarrollo (DEV)

El objetivo del entorno DEV es permitir a los equipos de desarrollo iterar rápidamente, experimentar y construir nuevas funcionalidades con la mínima fricción posible. La seguridad es importante, pero la velocidad y la flexibilidad son prioritarias.

### Objetivos Clave
*   Facilitar la creación y destrucción rápida de entornos efímeros.
*   Proporcionar acceso completo a los desarrolladores para la experimentación.
*   Establecer una base de sistema operativo coherente con los demás entornos.

### Propuesta de Roles para DEV
En este entorno, los roles son informales y se centran en la funcionalidad del equipo de desarrollo.
*   **`dev-team`**: Grupo principal para todos los miembros del equipo de desarrollo. Tienen acceso `sudo` completo y pueden gestionar sus propios servicios y datos.
*   **`dev-admin`**: Rol para el líder técnico o arquitecto del equipo, con las mismas capacidades que `dev-team`, pero con la responsabilidad adicional de mantener la coherencia del entorno.

### Configuración Base del Sistema Operativo

#### 1. Instalación Inicial
*   **Medio de Instalación:** Utilizar la imagen ISO de Rocky Linux 10 Minimal.
*   **Particionado:** Un solo volumen LVM para `/` es suficiente para la mayoría de los casos de uso en DEV.
*   **Usuarios:** Crear un usuario no-root con privilegios de `sudo` para el equipo de desarrollo. No es necesario crear múltiples cuentas de usuario en esta etapa.

#### 2. Configuración Post-Instalación
```bash
# 1. Actualizar el sistema a la última versión
sudo dnf update -y

# 2. Instalar herramientas esenciales de desarrollo y administración
sudo dnf install -y git vim tmux htop net-tools bind-utils

# 3. Configurar el nombre de host (FQDN)
sudo hostnamectl set-hostname dev-server.dev.example.com.mx
echo "127.0.0.1 dev-server.dev.example.com.mx dev-server" | sudo tee -a /etc/hosts

# 4. Configurar el firewall para permitir tráfico de desarrollo común
#    (SSH, HTTP, HTTPS, y puertos personalizados para apps)
sudo firewall-cmd --permanent --add-service={ssh,http,https}
sudo firewall-cmd --reload
```

#### 3. Gestión de Usuarios y Acceso
*   **Acceso SSH:** Configurar el acceso basado en claves SSH para el usuario de desarrollo. Las contraseñas pueden estar habilitadas para facilitar el acceso inicial.
*   **Gestión de Identidad:** En este entorno, la gestión de identidad suele ser local (`/etc/passwd`). No es necesario integrar con un servidor de identidad centralizado como FreeIPA en esta etapa temprana.

### Recomendaciones para DEV
*   **Infraestructura:** Ejecutar en contenedores **LXC** (Linux Containers), máquinas virtuales o instancias en la nube efímeras. **LXC** es una tecnología de virtualización a nivel de sistema operativo que permite ejecutar múltiples entornos Linux aislados en un solo kernel, siendo más ligeros y rápidos que las máquinas virtuales tradicionales.
*   **Copias de Seguridad:** No son obligatorias; el entorno se puede recrear desde cero usando scripts de IaC.
*   **Monitoreo:** Básico o inexistente. El foco está en la funcionalidad, no en la observabilidad.

## Etapa 2: Entorno de Pruebas (TEST)

El entorno TEST es un espejo controlado del entorno de producción. Aquí se validan todas las configuraciones, políticas y flujos de trabajo antes de su promoción. La estabilidad y la fidelidad a PROD son la máxima prioridad.

### Objetivos Clave
*   Simular fielmente la configuración y la topología de red de PROD.
*   Validar la integración completa del stack tecnológico (FreeIPA, PostgreSQL, Mayan EDMS, iDempiere).
*   Probar los procedimientos de recuperación ante desastres y las copias de seguridad.

### Propuesta de Roles para TEST y Configuración de FreeIPA
Este entorno requiere una definición formal de roles para simular la gobernanza de producción. La gestión de identidad se centraliza en un servidor FreeIPA de pruebas.

**Configuración de FreeIPA para TEST:**
*   **Dominio:** `test.example.com.mx`
*   **Reino Kerberos:** `TEST.EXAMPLE.COM.MX`
*   **Servidor:** `ipa-test.test.example.com.mx`

**Roles (Grupos de FreeIPA) a Crear:**
*   **`test-users`**: Grupo base para todos los usuarios que necesitan acceder al entorno de pruebas.
*   **`test-admins`**: Miembros de este grupo tienen acceso `sudo` completo a todos los servidores de pruebas. Este rol se asigna a los arquitectos y administradores de sistemas.
*   **`app-devs`**: Miembros de este grupo tienen acceso `sudo` limitado solo a los servidores de aplicaciones (por ejemplo, servidores de iDempiere o Mayan EDMS) para realizar tareas de depuración.
*   **`db-admins`**: Miembros de este grupo tienen acceso `sudo` limitado solo a los servidores de bases de datos (PostgreSQL) para tareas de mantenimiento.

Estos roles se traducen en reglas HBAC y de `sudo` en FreeIPA para restringir el acceso de forma granular.

### Configuración Base del Sistema Operativo

#### 1. Instalación Inicial
*   **Medio de Instalación:** Utilizar la misma imagen ISO de Rocky Linux 10 Minimal que en DEV.
*   **Particionado:** Replicar la estructura de particionado de PROD. Por ejemplo, volúmenes LVM separados para `/`, `/var`, `/home` y `/opt`.
*   **Usuarios:** **No crear ningún usuario durante la instalación.** La gestión de identidad se hará a través del dominio centralizado de FreeIPA. Durante el proceso de instalación gráfica o por línea de comandos, se debe omitir la creación de una cuenta de usuario estándar. Solo se configura la contraseña de root, que se usará exclusivamente para la fase de enrolamiento inicial en el dominio.

#### 2. Configuración Post-Instalación
```bash
# 1. Actualizar el sistema
sudo dnf update -y

# 2. Instalar las mismas herramientas esenciales que en DEV, más herramientas de prueba
sudo dnf install -y git vim tmux htop net-tools bind-utils stress-ng

# 3. Configurar el nombre de host (FQDN) para el entorno de pruebas
sudo hostnamectl set-hostname test-server.test.example.com.mx
echo "127.0.0.1 test-server.test.example.com.mx test-server" | sudo tee -a /etc/hosts

# 4. Configurar el firewall de forma más restrictiva, imitando a PROD
sudo firewall-cmd --permanent --add-service=ssh
# Solo abrir puertos específicos para las aplicaciones que se están probando
sudo firewall-cmd --reload
```

#### 3. Integración con la Plataforma de Identidad (FreeIPA)
Este es el paso crítico que diferencia a TEST de DEV. Todos los servidores deben enrolarse en el dominio de pruebas de FreeIPA.
```bash
# 1. Instalar el cliente de FreeIPA
sudo dnf install -y freeipa-client

# 2. Enrolar el servidor en el dominio de pruebas
#    (Se asume que el servidor ipa-test.test.example.com.mx ya está configurado)
sudo ipa-client-install \
  --domain=test.example.com.mx \
  --server=ipa-test.test.example.com.mx \
  --realm=TEST.EXAMPLE.COM.MX \
  --mkhomedir \
  --unattended \
  --principal admin \
  --password 'TestPassw0rd!'
```
Una vez enrolado, todos los accesos (SSH, `sudo`) se gestionarán a través de las políticas definidas en FreeIPA (HBAC, reglas de `sudo`).

### Gobernanza y Checklist de Calidad en TEST

> **Todo cambio en TEST debe provenir de una promoción formal desde DEV, documentada y aprobada mediante un checklist de calidad.**

Este principio es fundamental para mantener la integridad del entorno de pruebas. El flujo de trabajo debe ser el siguiente:

1.  **Desarrollo en DEV:** Un equipo implementa una nueva característica o corrección en su entorno de desarrollo.
2.  **Solicitud de Promoción:** El equipo crea una solicitud formal (por ejemplo, una *Pull Request* en el repositorio Git del proyecto) que describe los cambios y adjunta el artefacto de configuración (scripts de Ansible, archivos de configuración, etc.).
3.  **Revisión y Checklist:** Un revisor independiente (por ejemplo, el Project Manager o un Arquitecto) evalúa la solicitud contra un **Checklist de Calidad**. Este checklist debe incluir ítems como:
    *   ¿Los cambios están documentados?
    *   ¿Se han pasado las pruebas unitarias y de integración en DEV?
    *   ¿La configuración sigue los estándares de seguridad (SELinux, firewall)?
    *   ¿Los cambios son idempotentes (pueden aplicarse múltiples veces sin efectos secundarios)?
4.  **Promoción a TEST:** Si la solicitud pasa el checklist, se fusiona en la rama de código correspondiente a TEST (por ejemplo, `release/test`) y se dispara un pipeline de CI/CD que aplica los cambios al entorno de pruebas.
5.  **Pruebas en TEST:** El equipo realiza pruebas exhaustivas de aceptación en el entorno de pruebas.

> **Nota sobre el Ciclo de Retroalimentación:**
>
> *   **Éxito:** Si las pruebas en TEST son exitosas, los cambios se promueven a la rama de producción (`main`) y se despliegan en el entorno PROD siguiendo un proceso similar de aprobación y checklist.
> *   **Fracaso:** Si las pruebas en TEST fallan, **los cambios no deben permanecer en TEST**. El pipeline de CI/CD debe ejecutar un *rollback* automático a la última versión estable conocida. Además, la rama de código de TEST debe revertirse al estado anterior, y la solicitud de promoción debe cerrarse o marcarse como fallida. Los desarrolladores deben analizar la causa del fallo en su entorno de DEV y repetir el ciclo con una nueva solución.

### Recomendaciones para TEST
*   **Infraestructura:** Usar máquinas virtuales o instancias en la nube con almacenamiento persistente y respaldado.
*   **Copias de Seguridad:** Implementar un plan de copias de seguridad regular (por ejemplo, diario) para probar los procedimientos de restauración.
*   **Pruebas de Integración:** Realizar pruebas exhaustivas de autenticación, autorización y rendimiento con todas las aplicaciones del stack.

## Etapa 3: Entorno de Producción (PROD)

El entorno de producción es el sistema real que gestiona las identidades y los datos de los usuarios finales. La seguridad, la disponibilidad, la integridad de los datos y la conformidad normativa son la máxima prioridad absoluta.

### Objetivos Clave
*   Garantizar alta disponibilidad y resiliencia ante fallos.
*   Aplicar los más altos estándares de seguridad y cumplimiento.
*   Implementar monitoreo y alertas proactivas.

### Propuesta de Roles para PROD y Configuración de FreeIPA
La gobernanza en producción debe ser estricta y alineada con las políticas organizacionales.

**Configuración de FreeIPA para PROD:**
*   **Dominio:** `example.com.mx` (o el dominio corporativo real).
*   **Reino Kerberos:** `EXAMPLE.COM.MX`.
*   **Servidores:** Al menos dos servidores réplica (`ipa-prod01`, `ipa-prod02`) para alta disponibilidad.

**Roles (Grupos de FreeIPA) a Crear:**
*   **`prod-users`**: Grupo base para todos los usuarios corporativos.
*   **`sysadmins`**: Rol de máximo privilegio. Sus miembros tienen acceso `sudo ALL` a todos los servidores de infraestructura (pero no a los de aplicación o base de datos directamente).
*   **`app-support`**: Tiene acceso `sudo` limitado a los servidores de aplicaciones para tareas de soporte y reinicio de servicios, pero no para modificar la configuración del sistema.
*   **`db-support`**: Tiene acceso `sudo` limitado a los servidores de bases de datos para tareas de monitoreo y reinicio, pero no para acceder a los datos directamente.
*   **`security-auditors`**: Tiene permisos de solo lectura en los logs y la configuración de los servidores para fines de auditoría.

### Evaluación de Alternativas Tecnológicas para PROD y Soberanía Tecnológica

La elección de la plataforma de identidad y del sistema operativo base es crítica para la soberanía tecnológica. A continuación, se evalúan las alternativas:

| Criterio | **FreeIPA + Rocky Linux** | **Microsoft Active Directory + Windows Server** | **OpenLDAP + Debian/Ubuntu** |
| :--- | :--- | :--- | :--- |
| **Código Abierto** | Sí, 100%. Total transparencia y capacidad de auditoría. | No. Software propietario de "caja negra". | Sí, 100%. |
| **Soberanía Tecnológica** | **Alta.** Control total sobre el código, la infraestructura y los datos. Sin dependencia de licencias ni proveedores únicos. | **Baja.** Dependencia total del ecosistema y las políticas de Microsoft. Riesgo de vendor lock-in. | **Alta.** Control total, similar a FreeIPA. |
| **Integración con Stack Linux** | **Excelente.** Diseñado específicamente para entornos Linux empresariales. Integración nativa con SELinux, SSSD, etc. | Pobre. Requiere capas de compatibilidad (como Samba) que añaden complejidad y puntos de fallo. | Buena, pero requiere configuración manual extensa para lograr la misma funcionalidad que FreeIPA (Kerberos, DNS, PKI). |
| **Características Empresariales** | Completo (SSO, HBAC, sudo rules, PKI, DNS integrado). | Completo y maduro, pero dentro de su propio ecosistema. | Básico (solo LDAP). Se deben integrar otros componentes (Kerberos, DNS) manualmente. |
| **Costo Total de Propiedad (TCO)** | Bajo (sin costos de licencia, solo costos de operación). | Alto (licencias por usuario/servidor, costos de soporte). | Bajo (sin costos de licencia). |
| **Curva de Aprendizaje** | Moderada (para administradores de Linux). | Baja (para administradores de Windows). | Alta (requiere profundo conocimiento de múltiples subsistemas). |

**Conclusión de la Evaluación:**
Para una organización comprometida con la **soberanía tecnológica** y que opera un stack de software libre y de código abierto (como el propuesto: Rocky Linux, PostgreSQL, iDempiere), la combinación de **FreeIPA y Rocky Linux** es la opción superior. Ofrece un equilibrio perfecto entre funcionalidad empresarial completa, control total sobre la infraestructura y una integración nativa sin fricciones. Aunque OpenLDAP es una alternativa de código abierto, la complejidad de integrar y mantener un stack equivalente (LDAP + Kerberos + DNS + PKI) supera con creces los beneficios, especialmente cuando FreeIPA ya lo proporciona como una solución unificada y bien documentada.

### Configuración Base del Sistema Operativo

#### 1. Instalación Inicial
*   **Medio de Instalación:** Utilizar la misma imagen ISO de Rocky Linux 10 Minimal.
*   **Particionado:** Estructura de particionado robusta y segura. Se recomienda:
    *   `/boot`: Partición estándar (1-2 GB).
    *   Volúmenes LVM cifrados (LUKS2) para el resto del sistema (`/`, `/var`, `/home`, `/opt`).

> **ADVERTENCIA: Cifrado de Discos en Máquinas Virtuales sin Acceso a Consola**
>
> Si los volúmenes LVM que contienen los sistemas de archivos críticos (`/`, `/var`, etc.) están cifrados con LUKS y **no se tiene acceso físico o a una consola serial/IPMI remota**, el sistema **no podrá arrancar de forma autónoma**. Durante el arranque, el `initramfs` solicitará la contraseña de desbloqueo exclusivamente por la consola, lo que impedirá que la red y los servicios como SSH se inicien.
>
> **Solución recomendada:** Para entornos de producción virtualizados, implemente un mecanismo de desbloqueo remoto como **Clevis + Tang**. Esta solución permite un desbloqueo automático y seguro a través de la red, manteniendo la seguridad del cifrado de disco sin sacrificar la capacidad de arranque remoto.

*   **Usuarios:** **No crear ningún usuario durante la instalación.** Al igual que en TEST, la gestión de identidad se delega completamente al dominio centralizado de FreeIPA. La única cuenta que se configura es la de `root`, y su uso debe quedar restringido al proceso de enrolamiento inicial y a tareas de mantenimiento extremo.

#### 2. Configuración Post-Instalación de Alta Seguridad
```bash
# 1. Actualizar el sistema
sudo dnf update -y

# 2. Instalar solo las herramientas esenciales de administración. Nada de editores gráficos o herramientas de desarrollo.
sudo dnf install -y vim htop net-tools bind-utils

# 3. Configurar el nombre de host (FQDN) para producción
sudo hostnamectl set-hostname prod-server.example.com.mx
# La resolución DNS debe manejarse por un servidor DNS corporativo, no por /etc/hosts

# 4. Configurar el firewall de forma extremadamente restrictiva
#    Solo los puertos estrictamente necesarios para el servicio y la administración segura.
sudo firewall-cmd --permanent --add-service=ssh
# Ejemplo: Si es un servidor web, solo abrir 443/tcp
# sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --reload

# 5. Ajustes de seguridad del kernel y del sistema (sysctl)
#    (Estos ajustes deben ser parte de un perfil de seguridad corporativo)
echo 'net.ipv4.conf.all.rp_filter=1' | sudo tee -a /etc/sysctl.d/99-security.conf
echo 'kernel.kptr_restrict=2' | sudo tee -a /etc/sysctl.d/99-security.conf
sudo sysctl --system
```

#### 3. Integración con la Plataforma de Identidad Corporativa (FreeIPA)
La integración en PROD sigue el mismo principio que en TEST, pero con políticas mucho más estrictas.
```bash
# 1. Instalar el cliente de FreeIPA
sudo dnf install -y freeipa-client

# 2. Enrolar el servidor en el dominio de producción
sudo ipa-client-install \
  --domain=example.com.mx \
  --server=ipa-prod01.example.com.mx \
  --realm=EXAMPLE.COM.MX \
  --mkhomedir \
  --unattended \
  --principal admin \
  --password '<Contraseña_Segura_y_Gestionada>'
```
Las políticas HBAC y de `sudo` en PROD deben ser tan restrictivas como sea posible, siguiendo el principio de privilegio mínimo.

### Recomendaciones Críticas para PROD

1.  **Alta Disponibilidad (HA):** La configuración inicial de un solo servidor es solo el primer paso. **Inmediatamente después, se debe configurar un segundo servidor réplica para lograr HA.** Para servicios críticos, se deben usar clusters (por ejemplo, Pacemaker/Corosync para bases de datos).
2.  **Gestión de Secretos:** Todas las contraseñas, claves SSH y certificados deben gestionarse en un sistema centralizado de secretos (por ejemplo, HashiCorp Vault).
3.  **Certificados:** Reemplazar cualquier certificado autofirmado por certificados válidos emitidos por una Autoridad de Certificación (CA) institucional o pública de confianza.
4.  **Monitoreo y Logs:** Integrar el servidor con el sistema de monitoreo corporativo (Prometheus, Zabbix, etc.) y enviar todos los logs de auditoría a un SIEM (Security Information and Event Management) centralizado.
5.  **Auditorías y Conformidad:** Realizar auditorías de seguridad regulares y asegurar que la configuración cumple con las políticas corporativas y los marcos regulatorios aplicables (ISO 27001, etc.).
---
### Referencias

Fanta. (s.f.). *Instalación de servidor FreeIPA en RedHat 10.0 – Parte 2*. 56k.es.  https://56k.es/fanta/instalacion-de-servidor-freeipa-en-redhat-10-0-parte-1/

Fanta. (2025, junio 26). *Instalación de servidor FreeIPA en RedHat 10.0 – Parte 2*. 56k.es. https://56k.es/fanta/instalacion-de-servidor-freeipa-en-redhat-10-0-parte-2/

Smyth, N. (2023). *Red Hat Enterprise Linux 9 essentials*. Payload Media, Inc.

Smyth, N. (2023). *Rocky Linux 9 essentials*. Payload Media, Inc.

---
[^1]: Profesor-investigador del Departamento de Economía de la Universidad Autónoma Metropolitana, Unidad Iztapalapa. email: [jzr@xanum.uam.mx](mailto:jzr@xanum.uam.mx), [https://t.me/jzavalar](https://t.me/jzavalar).
