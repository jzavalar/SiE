# Guía de Instalación Mínima de FreeIPA en Rocky Linux 1
(para revisión)

Dr. Jesús Zavala Ruiz

*10 de Febrero de 2026*

---

Esta guía detalla el procedimiento para instalar y configurar un servidor FreeIPA mínimo en un entorno de Rocky Linux 10. La instalación se realiza en modo no interactivo (`--unattended`) para facilitar la automatización y la reproducibilidad, siguiendo las mejores prácticas documentadas para sistemas RHEL-derivados [[3]].

## Requisitos Previos

Antes de comenzar la instalación, es fundamental preparar el sistema anfitrión con una configuración base sólida. Estos pasos son críticos para el correcto funcionamiento de FreeIPA.

### 1. Configuración del Nombre de Host (FQDN)

FreeIPA requiere que el servidor tenga un nombre de host completamente cualificado (FQDN) que resuelva correctamente a su dirección IP. Este nombre será la base de su dominio IPA.

```bash
# Establecer el hostname estático
sudo hostnamectl set-hostname ipa-server.example.com.mx

# Verificar que el hostname esté correctamente configurado
hostnamectl status
```

Asegúrese de que el archivo `/etc/hosts` contenga una entrada que vincule la IP del servidor con su FQDN. Por ejemplo:
```
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.1.10 ipa-server.example.com.mx ipa-server
```

### 2. Sincronización de Tiempo con NTP

La autenticación Kerberos, que es el núcleo de FreeIPA, es extremadamente sensible a las diferencias de tiempo entre los servidores y los clientes. Una desviación de más de 5 minutos hará que la autenticación falle. Por lo tanto, es obligatorio configurar un servicio de sincronización de tiempo.

```bash
# Instalar chrony si no está presente
sudo dnf install -y chrony

# Iniciar y habilitar el servicio chronyd
sudo systemctl enable --now chronyd

# Verificar la sincronización
chronyc tracking
```

### 3. Configuración del Firewall

FreeIPA utiliza una variedad de puertos para sus diferentes servicios (LDAP, Kerberos, DNS, HTTP, etc.). Es esencial abrir estos puertos en el firewall del sistema. El paquete `freeipa-server` incluye un perfil de firewall predefinido para `firewalld`.

```bash
# Habilitar e iniciar firewalld si no está activo
sudo systemctl enable --now firewalld

# Agregar el servicio 'freeipa-ldap' al firewall
sudo firewall-cmd --permanent --add-service=freeipa-ldap

# Agregar el servicio 'freeipa-ldaps' al firewall (para conexiones cifradas)
sudo firewall-cmd --permanent --add-service=freeipa-ldaps

# Recargar la configuración del firewall
sudo firewall-cmd --reload
```

## Procedimiento de Instalación

Con los requisitos previos satisfechos, se puede proceder a la instalación del servidor FreeIPA.

### 1. Instalación de los Paquetes Necesarios

El primer paso es instalar los paquetes del servidor FreeIPA desde los repositorios oficiales de Rocky Linux.

```bash
# Instalar los paquetes del servidor FreeIPA
sudo dnf install -y freeipa-server freeipa-server-dns
```

El paquete `freeipa-server` contiene los componentes principales del servidor. El paquete `freeipa-server-dns` es opcional pero altamente recomendado, ya que instala y configura un servidor DNS integrado (BIND), que es crucial para la correcta resolución de nombres y la publicación de registros de servicio (SRV) necesarios para Kerberos [[3]].

### 2. Ejecución del Script de Instalación

Una vez instalados los paquetes, se ejecuta el script de instalación `ipa-server-install`. Para una instalación mínima y reproducible, se utiliza el modo no interactivo (`--unattended`) y se proporcionan todos los parámetros necesarios como argumentos.

```bash
sudo ipa-server-install \
  --domain=example.com.mx \
  --realm=EXAMPLE.COM.MX \
  --hostname=ipa-server.example.com.mx \
  --setup-dns \
  --forwarder=8.8.8.8 \
  --forwarder=8.8.4.4 \
  --unattended \
  --admin-password='Passw0rd!' \
  --ds-password='Passw0rd!'
```

**Explicación de los parámetros:**
*   `--domain`: Define el nombre de dominio DNS (por ejemplo, `example.com.mx`).
*   `--realm`: Define el nombre del reino Kerberos, que por convención suele ser el nombre de dominio en mayúsculas (por ejemplo, `EXAMPLE.COM.MX`).
*   `--hostname`: Especifica el FQDN del servidor.
*   `--setup-dns`: Indica que se debe configurar el servidor DNS integrado.
*   `--forwarder`: Especifica los servidores DNS upstream a los que el servidor DNS de FreeIPA debe enviar consultas que no puede resolver localmente.
*   `--unattended`: Ejecuta la instalación sin interacción del usuario.
*   `--admin-password`: Establece la contraseña para el usuario administrativo `admin`.
*   `--ds-password`: Establece la contraseña para el "Directory Manager", la cuenta de superusuario del directorio LDAP subyacente.

### 3. Verificación de la Instalación

Tras la finalización exitosa del script de instalación, se deben realizar algunas verificaciones para confirmar que el servidor está operativo.

```bash
# 1. Verificar que el servicio principal de IPA está activo
systemctl is-active ipa

# 2. Verificar que el usuario 'admin' existe en el directorio
ipa user-show admin

# 3. Verificar que el KDC (Kerberos) está respondiendo
kinit admin
# Se le pedirá la contraseña de 'admin'
klist
# Debe mostrar un TGT (Ticket Granting Ticket) válido
```

Si todos estos comandos se ejecutan sin errores, la instalación mínima de FreeIPA en Rocky Linux 10 se ha completado con éxito. El servidor está listo para enrolar clientes y gestionar identidades.

**Fuente:** La guía se basa en la documentación oficial y ejemplos de configuración para Rocky Linux 10, tal como se describe en Server World [[3]].
